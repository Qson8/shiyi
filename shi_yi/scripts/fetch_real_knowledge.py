#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
从真实来源抓取汉服知识库数据
使用网络爬虫和API获取真实、丰富、不重复的汉服知识内容
"""

import json
import os
import time
import random
from datetime import datetime
from typing import List, Dict, Optional
import re

# 尝试导入网络库，如果不可用则跳过网络抓取功能
try:
    import requests
    from bs4 import BeautifulSoup
    HAS_NETWORK_LIBS = True
except ImportError:
    HAS_NETWORK_LIBS = False
    print("警告：未安装requests和beautifulsoup4，将仅使用手工整理的内容")

# 请求头，模拟浏览器访问
HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'Connection': 'keep-alive',
}

# 延迟设置，避免请求过快
REQUEST_DELAY = (1, 3)  # 每次请求间隔1-3秒


class KnowledgeFetcher:
    """汉服知识抓取器"""
    
    def __init__(self):
        if HAS_NETWORK_LIBS:
            self.session = requests.Session()
            self.session.headers.update(HEADERS)
        else:
            self.session = None
        self.items = []
        self.seen_titles = set()
        self.seen_contents = set()
    
    def _delay(self):
        """随机延迟，避免请求过快"""
        time.sleep(random.uniform(*REQUEST_DELAY))
    
    def _clean_text(self, text: str) -> str:
        """清理文本内容"""
        if not text:
            return ""
        # 移除多余的空白字符
        text = re.sub(r'\s+', ' ', text)
        # 移除特殊字符但保留中文标点
        text = re.sub(r'[^\u4e00-\u9fa5\w\s，。！？；：、""''（）【】《》]', '', text)
        return text.strip()
    
    def _extract_content(self, html: str) -> str:
        """从HTML中提取文本内容"""
        soup = BeautifulSoup(html, 'html.parser')
        
        # 移除script和style标签
        for script in soup(["script", "style"]):
            script.decompose()
        
        # 提取主要文本内容
        text = soup.get_text()
        return self._clean_text(text)
    
    def fetch_baidu_baike(self, keyword: str) -> Optional[Dict]:
        """从百度百科抓取内容"""
        if not HAS_NETWORK_LIBS or not self.session:
            return None
        try:
            url = f"https://baike.baidu.com/item/{keyword}"
            self._delay()
            response = self.session.get(url, timeout=10)
            response.encoding = 'utf-8'
            
            if response.status_code != 200:
                return None
            
            soup = BeautifulSoup(response.text, 'html.parser')
            
            # 提取标题
            title_elem = soup.find('h1', class_='lemmaWgt-lemmaTitle-title')
            if not title_elem:
                title_elem = soup.find('dd', class_='lemmaWgt-lemmaTitle-title')
            title = title_elem.get_text().strip() if title_elem else keyword
            
            # 提取主要内容
            main_content = soup.find('div', class_='lemma-summary')
            if not main_content:
                main_content = soup.find('div', class_='main-content')
            
            if not main_content:
                return None
            
            # 提取段落
            paragraphs = []
            for p in main_content.find_all(['p', 'div'], recursive=False):
                text = self._clean_text(p.get_text())
                if text and len(text) > 20:  # 过滤太短的内容
                    paragraphs.append(text)
            
            content = '\n\n'.join(paragraphs)
            
            if len(content) < 50:  # 内容太短，跳过
                return None
            
            return {
                'title': title,
                'content': content,
                'source': '百度百科'
            }
        except Exception as e:
            print(f"抓取百度百科失败 ({keyword}): {e}")
            return None
    
    def fetch_wiki_content(self, keyword: str) -> Optional[Dict]:
        """从中文维基百科抓取内容"""
        if not HAS_NETWORK_LIBS or not self.session:
            return None
        try:
            url = f"https://zh.wikipedia.org/wiki/{keyword}"
            self._delay()
            response = self.session.get(url, timeout=10)
            response.encoding = 'utf-8'
            
            if response.status_code != 200:
                return None
            
            soup = BeautifulSoup(response.text, 'html.parser')
            
            # 提取标题
            title_elem = soup.find('h1', class_='firstHeading')
            title = title_elem.get_text().strip() if title_elem else keyword
            
            # 提取主要内容
            content_div = soup.find('div', class_='mw-parser-output')
            if not content_div:
                return None
            
            paragraphs = []
            for p in content_div.find_all('p', recursive=False):
                text = self._clean_text(p.get_text())
                if text and len(text) > 30:
                    paragraphs.append(text)
            
            content = '\n\n'.join(paragraphs[:5])  # 只取前5段
            
            if len(content) < 100:
                return None
            
            return {
                'title': title,
                'content': content,
                'source': '维基百科'
            }
        except Exception as e:
            print(f"抓取维基百科失败 ({keyword}): {e}")
            return None
    
    def create_knowledge_item(self, title: str, content: str, category: str, 
                              tags: List[str], source: str = "") -> Dict:
        """创建知识库条目"""
        # 检查重复
        title_key = title.lower().strip()
        content_key = content[:200].lower().strip()  # 用前200字符判断重复
        
        if title_key in self.seen_titles or content_key in self.seen_contents:
            return None
        
        self.seen_titles.add(title_key)
        self.seen_contents.add(content_key)
        
        item_id = f"kb_{len(self.items) + 1:04d}"
        
        # 添加来源信息
        if source:
            content += f"\n\n【来源】{source}"
        
        return {
            "id": item_id,
            "title": title,
            "category": category,
            "content": content,
            "images": [],
            "tags": tags,
            "isFavorite": False,
            "createdAt": datetime.now().isoformat()
        }
    
    def generate_real_knowledge(self):
        """生成真实的知识库数据"""
        print("开始抓取真实汉服知识库数据...")
        
        # 形制科普关键词列表
        shape_keywords = [
            # 唐代形制
            "齐胸襦裙", "齐腰襦裙", "大袖衫", "半臂", "帔子", "诃子", "破裙", "间色裙", "坦领",
            # 宋代形制
            "褙子", "百迭裙", "衫子", "三襕裙", "两片裙", "旋裙", "宋裤", "抹胸",
            # 明代形制
            "马面裙", "袄裙", "道袍", "披风", "直身", "直裰", "圆领袍", "比甲", "立领衫",
            # 魏晋形制
            "魏晋襦裙", "魏晋大袖衫", "魏晋半臂",
            # 秦汉形制
            "深衣", "曲裾", "直裾", "秦汉襦裙",
        ]
        
        # 历史背景关键词
        history_keywords = [
            "汉服历史", "汉服起源", "汉服文化", "汉服演变", "唐代服饰", "宋代服饰", 
            "明代服饰", "魏晋服饰", "秦汉服饰", "汉服复兴", "汉服运动",
        ]
        
        # 穿搭指南关键词
        styling_keywords = [
            "汉服穿搭", "汉服搭配", "汉服配色", "汉服配饰", "汉服保养", "汉服选购",
            "汉服定制", "汉服礼仪", "汉服节日",
        ]
        
        # 抓取形制科普（如果网络库可用）
        if HAS_NETWORK_LIBS:
            print("\n正在抓取形制科普数据...")
            for keyword in shape_keywords:
                print(f"  抓取: {keyword}")
                # 尝试百度百科
                data = self.fetch_baidu_baike(keyword)
                if not data:
                    # 尝试维基百科
                    data = self.fetch_wiki_content(keyword)
                
                if data:
                    item = self.create_knowledge_item(
                        title=f"{data['title']} - 形制特点",
                        content=data['content'],
                        category="形制科普",
                        tags=[keyword, "形制", "科普"],
                        source=data.get('source', '')
                    )
                    if item:
                        self.items.append(item)
                        print(f"    ✓ 成功添加: {item['title']}")
        
        # 抓取历史背景（如果网络库可用）
        if HAS_NETWORK_LIBS:
            print("\n正在抓取历史背景数据...")
            for keyword in history_keywords:
                print(f"  抓取: {keyword}")
                data = self.fetch_baidu_baike(keyword)
                if not data:
                    data = self.fetch_wiki_content(keyword)
                
                if data:
                    item = self.create_knowledge_item(
                        title=f"{data['title']} - 历史背景",
                        content=data['content'],
                        category="历史背景",
                        tags=[keyword, "历史", "文化"],
                        source=data.get('source', '')
                    )
                    if item:
                        self.items.append(item)
                        print(f"    ✓ 成功添加: {item['title']}")
        
        # 抓取穿搭指南（如果网络库可用）
        if HAS_NETWORK_LIBS:
            print("\n正在抓取穿搭指南数据...")
            for keyword in styling_keywords:
                print(f"  抓取: {keyword}")
                data = self.fetch_baidu_baike(keyword)
                if not data:
                    data = self.fetch_wiki_content(keyword)
                
                if data:
                    item = self.create_knowledge_item(
                        title=f"汉服{keyword} - 实用指南",
                        content=data['content'],
                        category="穿搭指南",
                        tags=[keyword, "穿搭", "指南"],
                        source=data.get('source', '')
                    )
                    if item:
                        self.items.append(item)
                        print(f"    ✓ 成功添加: {item['title']}")
        
        # 添加一些手工整理的真实知识内容
        self._add_manual_knowledge()
        
        print(f"\n抓取完成！共获得 {len(self.items)} 条真实知识数据")
        return self.items
    
    def _add_manual_knowledge(self):
        """添加手工整理的真实汉服知识"""
        manual_items = [
            # ========== 形制科普 ==========
            {
                "title": "齐胸襦裙的形制特点与历史",
                "category": "形制科普",
                "content": """齐胸襦裙是唐代流行的女装款式，其形制特点主要体现在以下几个方面：

【形制特点】
1. 上襦：通常为对襟或交领短襦，长度至腰部，袖型有直袖、琵琶袖等
2. 下裙：高腰长裙，裙头位置在胸部下方，通过系带固定
3. 系带：使用长带子在胸前交叉系紧，形成独特的穿着效果

【历史背景】
齐胸襦裙在唐代（618-907年）最为流行，是唐代女性日常穿着的典型服饰。从唐代壁画、陶俑等文物中可以看到大量齐胸襦裙的形象，如敦煌莫高窟壁画中的供养人形象。

【穿着方法】
1. 先穿好内搭（如中衣）
2. 将上襦穿好，系好衣带
3. 将下裙围在胸前，裙头位置在胸部下方
4. 用长带子在胸前交叉，绕到背后系紧
5. 整理裙摆，使其自然垂坠

【文化意义】
齐胸襦裙体现了唐代开放包容的社会风气，展现了唐代女性的雍容华贵之美。这种服饰不仅实用，更具有深厚的文化内涵，是了解唐代服饰文化的重要窗口。""",
                "tags": ["唐代", "齐胸襦裙", "形制", "历史"]
            },
            {
                "title": "齐腰襦裙与齐胸襦裙的区别",
                "category": "形制科普",
                "content": """齐腰襦裙和齐胸襦裙是两种不同的襦裙形制，主要区别在于裙头的位置。

【主要区别】
1. 裙头位置：
   - 齐胸襦裙：裙头位置在胸部下方，通过系带固定在胸前
   - 齐腰襦裙：裙头位置在腰部，系带在腰部

2. 视觉效果：
   - 齐胸襦裙：显得更加高挑，拉长下半身比例
   - 齐腰襦裙：更加自然，符合现代审美

3. 穿着感受：
   - 齐胸襦裙：对胸部有一定要求，需要系带较紧
   - 齐腰襦裙：穿着更舒适，适合日常

【历史演变】
齐腰襦裙的历史可以追溯到更早的时期，而齐胸襦裙主要在唐代流行。宋代以后，齐腰襦裙逐渐成为主流。

【现代选择】
现代汉服爱好者可以根据个人喜好和身材特点选择：
- 身材高挑、喜欢华丽风格：可选择齐胸襦裙
- 日常穿着、追求舒适：可选择齐腰襦裙""",
                "tags": ["唐代", "齐腰襦裙", "齐胸襦裙", "区别"]
            },
            {
                "title": "褙子的形制特点与穿着方法",
                "category": "形制科普",
                "content": """褙子是宋代最具代表性的外衣，其形制简洁优雅，深受现代汉服爱好者喜爱。

【形制特点】
1. 对襟设计：褙子为对襟，两侧开衩，方便活动
2. 长度变化：有长褙子和短褙子之分，长褙子至膝盖，短褙子至腰部
3. 袖型：通常为直袖，袖口较窄
4. 系带：使用系带或纽扣固定

【历史背景】
褙子在宋代（960-1279年）最为流行，是宋代女性日常穿着的标准外衣。从宋代绘画如《清明上河图》中可以看到大量褙子的形象。

【穿着方法】
1. 先穿好内搭（如衫子、抹胸）
2. 将褙子套在外面，对襟对齐
3. 使用系带或纽扣固定
4. 可搭配百迭裙、两片裙等下裳

【搭配建议】
- 日常：褙子+衫子+百迭裙
- 正式：长褙子+衫子+马面裙
- 休闲：短褙子+宋裤

【现代应用】
褙子因其简洁优雅的特点，在现代汉服中非常受欢迎，是日常穿着的理想选择。""",
                "tags": ["宋代", "褙子", "形制", "穿着"]
            },
            {
                "title": "百迭裙的制作工艺与特点",
                "category": "形制科普",
                "content": """百迭裙是宋代流行的下裳，以其丰富的褶裥而得名。

【形制特点】
1. 褶裥丰富：裙身布满细密的褶裥，通常有数十道甚至上百道
2. 裙腰：使用宽腰头，便于穿着
3. 长度：通常至脚踝，也有及地款式

【制作工艺】
1. 裁剪：按照尺寸裁剪裙片
2. 打褶：使用专用工具打出整齐的褶裥，这是制作的关键步骤
3. 定型：使用熨斗定型，保持褶裥的整齐
4. 上腰：将裙腰与裙身缝合

【历史演变】
百迭裙在宋代达到鼎盛，是宋代女性日常穿着的标准下裳。从宋代文物和绘画中可以看到，百迭裙的褶裥数量和密度在不同时期有所变化。

【穿着技巧】
1. 穿着时要保持褶裥的整齐
2. 坐下时注意整理，避免压皱
3. 清洗后需要重新定型褶裥

【现代传承】
百迭裙在现代汉服中非常受欢迎，是日常穿着的理想选择。现代制作的百迭裙在保持传统形制的基础上，在面料和颜色方面有所创新。""",
                "tags": ["宋代", "百迭裙", "形制", "工艺"]
            },
            {
                "title": "马面裙的制作工艺与特点",
                "category": "形制科普",
                "content": """马面裙是明代最具代表性的女装下裳，其制作工艺精湛，形制独特。

【形制特点】
马面裙由两片相同的裙片组成，每片裙片都有：
1. 裙门：正面和背面各有一个光面（马面），不施褶裥
2. 褶裥：裙门两侧各有数道褶裥，通常为6-12道
3. 裙腰：使用宽腰头，便于穿着

【制作工艺】
1. 裁剪：按照尺寸裁剪裙片，注意裙门和褶裥的布局
2. 打褶：使用熨斗和专用工具打出整齐的褶裥
3. 缝合：将两片裙片在两侧缝合，留出裙门
4. 上腰：将裙腰与裙身缝合
5. 装饰：可在裙门处刺绣或装饰

【历史演变】
马面裙在明代（1368-1644年）达到鼎盛，是明代女性正式场合的标准下裳。从明代文物和画像中可以看到，马面裙的褶裥数量、裙门宽度等在不同时期有所变化。

【现代传承】
马面裙在现代汉服复兴中占据重要地位，是汉服爱好者最喜爱的形制之一。现代制作的马面裙在保持传统形制的基础上，在面料、颜色、装饰等方面有所创新。""",
                "tags": ["明代", "马面裙", "形制", "工艺"]
            },
            {
                "title": "袄裙的形制特点与搭配",
                "category": "形制科普",
                "content": """袄裙是明代最具代表性的女装组合，由袄和裙两部分组成。

【形制特点】
1. 袄：上身穿着的上衣，有立领、交领、对襟等款式
2. 裙：下身穿着的下裳，通常为马面裙
3. 长度：袄的长度通常在腰部或臀部

【款式变化】
1. 立领袄：明代最具特色的款式，领子直立
2. 交领袄：传统款式，领子交叉
3. 对襟袄：前襟对开，使用纽扣或系带

【搭配方式】
- 立领袄+马面裙：明代最经典的搭配
- 交领袄+马面裙：传统搭配方式
- 对襟袄+马面裙：现代改良搭配

【历史背景】
袄裙在明代达到鼎盛，是明代女性正式场合的标准装束。从明代画像和文物中可以看到，袄裙的款式和搭配在不同时期有所变化。

【现代应用】
袄裙在现代汉服中非常受欢迎，是正式场合的理想选择。现代制作的袄裙在保持传统形制的基础上，在面料、颜色、装饰等方面有所创新。""",
                "tags": ["明代", "袄裙", "形制", "搭配"]
            },
            {
                "title": "大袖衫的形制特点与穿着场合",
                "category": "形制科普",
                "content": """大袖衫是唐代和魏晋时期流行的外衣，以其宽大的袖子而得名。

【形制特点】
1. 袖子：袖子非常宽大，通常宽度在50-80厘米
2. 长度：通常较长，至膝盖或更长
3. 领型：有交领、对襟等款式
4. 材质：通常使用轻薄的面料，如真丝、薄纱等

【历史背景】
大袖衫在魏晋时期（220-589年）和唐代（618-907年）最为流行，是贵族女性的标志性服饰。从魏晋画像和唐代壁画中可以看到大量大袖衫的形象。

【穿着场合】
1. 正式场合：大袖衫适合正式场合，如婚礼、庆典等
2. 艺术表演：适合舞蹈、戏剧等艺术表演
3. 拍照写真：适合拍摄古风写真

【搭配建议】
- 大袖衫+齐胸襦裙：唐代经典搭配
- 大袖衫+深衣：魏晋风格搭配
- 大袖衫+现代内搭：现代混搭风格

【现代应用】
大袖衫在现代汉服中主要用于特殊场合，因其宽大的袖子不太适合日常活动。但在艺术表演和拍照中非常受欢迎。""",
                "tags": ["唐代", "魏晋", "大袖衫", "形制"]
            },
            {
                "title": "深衣的形制特点与文化意义",
                "category": "形制科普",
                "content": """深衣是秦汉时期最具代表性的服饰，是汉服体系中的重要形制。

【形制特点】
1. 一体式设计：上衣和下裳连在一起，形成一体
2. 长度：通常较长，至脚踝或及地
3. 领型：通常为交领
4. 腰带：使用腰带束腰，形成腰线

【历史背景】
深衣在秦汉时期（前221-220年）最为流行，是当时男女通用的服饰。从汉代画像石和文物中可以看到大量深衣的形象。

【文化意义】
深衣体现了"天人合一"的哲学思想，上衣象征天，下裳象征地，体现了古人对宇宙的理解。深衣也是礼制的重要体现，不同身份的人穿着不同等级的深衣。

【制作工艺】
1. 裁剪：需要精确的裁剪，确保上下连为一体
2. 缝合：需要精细的缝合工艺
3. 装饰：可在领口、袖口等处装饰

【现代传承】
深衣在现代汉服中主要用于正式场合和传统文化活动，是了解秦汉服饰文化的重要窗口。""",
                "tags": ["秦汉", "深衣", "形制", "文化"]
            },
            {
                "title": "曲裾与直裾的区别",
                "category": "形制科普",
                "content": """曲裾和直裾是深衣的两种不同款式，主要区别在于衣襟的处理方式。

【主要区别】
1. 衣襟：
   - 曲裾：衣襟呈曲线，绕身一周或数周
   - 直裾：衣襟呈直线，直接下垂

2. 视觉效果：
   - 曲裾：更加优雅，线条流畅
   - 直裾：更加简洁，穿着方便

3. 历史时期：
   - 曲裾：主要在汉代早期流行
   - 直裾：在汉代中后期逐渐取代曲裾

【穿着方法】
1. 曲裾：需要将衣襟绕身，形成曲线效果
2. 直裾：直接穿着，衣襟自然下垂

【历史演变】
从汉代文物和画像中可以看到，曲裾在汉代早期较为流行，而直裾在汉代中后期逐渐成为主流。这一变化反映了服饰实用性的提升。

【现代选择】
现代汉服爱好者可以根据个人喜好选择：
- 喜欢优雅风格：可选择曲裾
- 追求实用方便：可选择直裾""",
                "tags": ["秦汉", "曲裾", "直裾", "区别"]
            },
            {
                "title": "宋裤的形制特点与现代应用",
                "category": "形制科普",
                "content": """宋裤是宋代流行的下裳，是汉服中少有的裤装形制。

【形制特点】
1. 分片设计：由两片裤腿组成，在中间缝合
2. 长度：通常较长，至脚踝
3. 腰头：使用宽腰头，便于穿着
4. 开衩：两侧有开衩，方便活动

【历史背景】
宋裤在宋代（960-1279年）最为流行，是宋代女性日常穿着的标准下裳。从宋代绘画和文物中可以看到宋裤的形象。

【穿着方法】
1. 先穿好内搭
2. 将宋裤穿好，系好腰带
3. 可搭配褙子、衫子等上衣

【现代应用】
宋裤因其方便活动的特点，在现代汉服中非常受欢迎，是日常穿着的理想选择。现代制作的宋裤在保持传统形制的基础上，在面料和颜色方面有所创新。

【搭配建议】
- 宋裤+褙子：宋代经典搭配
- 宋裤+衫子：日常舒适搭配
- 宋裤+现代上衣：现代混搭风格""",
                "tags": ["宋代", "宋裤", "形制", "现代"]
            },
            # ========== 历史背景 ==========
            {
                "title": "汉服复兴运动的历史与意义",
                "category": "历史背景",
                "content": """汉服复兴运动是21世纪初在中国兴起的一场文化复兴运动，旨在恢复和传承汉族传统服饰文化。

【历史背景】
汉服复兴运动起源于2003年左右，最初由一些热爱传统文化的年轻人发起。他们通过网络论坛、线下活动等方式，逐渐形成了汉服社群。

【发展阶段】
1. 初期（2003-2008）：以网络传播为主，主要参与者是大学生和年轻白领
2. 发展期（2008-2015）：线下活动增多，汉服节、汉服出行等活动兴起
3. 成熟期（2015至今）：汉服产业形成，商业化程度提高，社会认知度大幅提升

【主要活动】
- 汉服出行日：每年11月22日，汉服爱好者穿着汉服走上街头
- 汉服节：各地举办的汉服文化节，展示汉服文化
- 汉服婚礼：采用传统汉服婚礼仪式
- 汉服教育：在学校、社区推广汉服文化

【文化意义】
汉服复兴运动不仅是对传统服饰的恢复，更是对中华优秀传统文化的传承和弘扬。它体现了当代中国人对文化自信的追求，对民族认同的强化。

【社会影响】
随着汉服复兴运动的发展，汉服逐渐从小众文化走向大众视野。越来越多的年轻人开始了解、接受和穿着汉服，汉服产业也迅速发展，形成了完整的产业链。""",
                "tags": ["汉服复兴", "历史", "文化", "运动"]
            },
            {
                "title": "汉服的历史起源与发展",
                "category": "历史背景",
                "content": """汉服的历史可以追溯到数千年前，是中华文明的重要组成部分。

【历史起源】
汉服的基本形制在商周时期（约前1600-前256年）已经形成，经过数千年的发展演变，形成了完整的服饰体系。汉服不仅是服饰，更是中华文化的重要载体。

【发展历程】
1. 商周时期：基本形制形成，建立了完整的服饰制度
2. 秦汉时期：深衣、曲裾等形制成熟，成为主流
3. 魏晋时期：服饰风格飘逸，大袖衫等形制流行
4. 隋唐时期：服饰开放包容，齐胸襦裙等形制盛行
5. 宋元时期：服饰简洁实用，褙子、百迭裙等形制流行
6. 明清时期：袄裙、马面裙等形制成熟，成为标准

【文化传承】
汉服在历史上不仅是日常穿着，更是礼制的重要体现。不同身份、不同场合穿着不同的汉服，体现了古代社会的等级制度和礼仪规范。

【现代意义】
了解汉服的历史起源与发展，有助于更好地理解中华文化的深厚底蕴，增强文化自信和民族认同。""",
                "tags": ["汉服历史", "起源", "发展", "文化"]
            },
            {
                "title": "唐代服饰文化的特点与影响",
                "category": "历史背景",
                "content": """唐代是中国历史上最繁荣的时期之一，其服饰文化也达到了前所未有的高度。

【时代背景】
唐代（618-907年）是中国历史上的黄金时代，政治稳定、经济繁荣、文化开放，这些都为服饰文化的发展提供了良好的条件。

【服饰特点】
1. 开放包容：唐代服饰吸收了西域、中亚等地的服饰元素
2. 色彩丰富：唐代服饰色彩鲜艳，体现了开放的社会风气
3. 款式多样：齐胸襦裙、大袖衫、半臂等形制丰富
4. 工艺精湛：唐代服饰工艺水平极高，丝绸、刺绣等技术成熟

【文化影响】
唐代服饰文化对后世产生了深远影响，不仅影响了中国，也影响了日本、韩国等周边国家。唐代服饰的开放包容精神，至今仍为人们所称道。

【文物见证】
从唐代壁画、陶俑、绘画等文物中，我们可以看到唐代服饰的丰富多样。敦煌莫高窟壁画中的供养人形象，生动地展现了唐代服饰的风采。

【现代传承】
唐代服饰在现代汉服中占据重要地位，齐胸襦裙等形制深受现代汉服爱好者喜爱。""",
                "tags": ["唐代", "服饰文化", "历史", "影响"]
            },
            {
                "title": "宋代服饰文化的简约风格",
                "category": "历史背景",
                "content": """宋代服饰文化以简约实用为特点，体现了宋代文人的审美追求。

【时代背景】
宋代（960-1279年）是中国历史上文化高度发达的时期，理学思想盛行，文人地位提高，这些都对服饰文化产生了影响。

【服饰特点】
1. 简约实用：宋代服饰追求简约，注重实用性
2. 色彩素雅：宋代服饰色彩相对素雅，体现了文人的审美
3. 形制简洁：褙子、百迭裙等形制简洁优雅
4. 工艺精细：虽然简约，但工艺依然精细

【文化内涵】
宋代服饰体现了"淡泊明志"的文人精神，追求内在的美而非外在的华丽。这种审美观念对后世产生了深远影响。

【文物见证】
从宋代绘画如《清明上河图》中，我们可以看到宋代服饰的日常穿着情况。宋代墓葬出土的文物，也为我们了解宋代服饰提供了实物证据。

【现代影响】
宋代服饰的简约风格在现代汉服中非常受欢迎，褙子、百迭裙等形制是日常穿着的理想选择。""",
                "tags": ["宋代", "服饰文化", "简约", "历史"]
            },
            {
                "title": "明代服饰文化的规范体系",
                "category": "历史背景",
                "content": """明代建立了完整的服饰规范体系，对后世产生了重要影响。

【时代背景】
明代（1368-1644年）是中国历史上最后一个由汉族建立的统一王朝，其服饰制度规范严格，等级分明。

【服饰特点】
1. 形制规范：明代建立了完整的服饰形制规范
2. 等级分明：不同身份的人穿着不同等级的服饰
3. 工艺精湛：明代服饰工艺水平极高，刺绣、织锦等技术成熟
4. 款式丰富：袄裙、马面裙、道袍等形制丰富

【规范体系】
明代制定了详细的服饰制度，对不同身份、不同场合的服饰都有明确规定。这种规范体系体现了明代社会的等级制度和礼仪规范。

【文物见证】
从明代画像、文物中，我们可以看到明代服饰的规范性和丰富性。明代墓葬出土的服饰文物，为我们了解明代服饰提供了实物证据。

【现代传承】
明代服饰在现代汉服中占据重要地位，袄裙、马面裙等形制是正式场合的理想选择。""",
                "tags": ["明代", "服饰文化", "规范", "历史"]
            },
            {
                "title": "汉服与传统文化的关系",
                "category": "历史背景",
                "content": """汉服是中华传统文化的重要组成部分，与传统文化有着密切的关系。

【文化载体】
汉服不仅是服饰，更是中华文化的重要载体。它承载着历史记忆、文化传统、审美观念等多重文化内涵。

【礼制体现】
汉服体现了古代中国的礼制思想，不同身份、不同场合穿着不同的汉服，体现了"礼"的精神。

【哲学思想】
汉服的形制设计体现了"天人合一"的哲学思想，如深衣的上衣下裳象征天地，体现了古人对宇宙的理解。

【艺术表现】
汉服是传统艺术的重要表现形式，与绘画、书法、音乐、舞蹈等艺术形式相互影响，共同构成了中华文化的艺术体系。

【现代意义】
了解汉服与传统文化的关系，有助于更好地理解中华文化的深厚底蕴，增强文化自信和民族认同。""",
                "tags": ["汉服", "传统文化", "文化", "关系"]
            },
            # ========== 穿搭指南 ==========
            {
                "title": "汉服日常穿搭的基本原则",
                "category": "穿搭指南",
                "content": """汉服日常穿搭需要掌握一些基本原则，才能既美观又实用。

【形制选择】
1. 日常穿着建议选择简洁的形制，如褙子、衫裙等
2. 避免过于复杂的形制，如大袖衫、多层叠穿等
3. 选择适合现代生活的改良款式

【颜色搭配】
1. 同色系搭配：选择同一色系的不同深浅，如浅粉配深粉
2. 对比色搭配：选择对比色，但要控制比例，如主色占70%，辅色占30%
3. 中性色搭配：黑白灰等中性色与任何颜色都容易搭配

【配饰选择】
1. 发饰：日常可选择简单的发簪、发带
2. 腰带：选择与服装颜色协调的腰带
3. 鞋子：可选择绣花鞋、布鞋，或现代风格的平底鞋

【场合适应】
1. 工作场合：选择素雅的款式和颜色，避免过于华丽
2. 休闲场合：可以选择活泼的颜色和款式
3. 正式场合：选择传统形制，颜色庄重

【季节考虑】
1. 春夏：选择轻薄面料，如棉麻、真丝
2. 秋冬：选择厚实面料，如呢料、毛料，可加内搭

【实用建议】
1. 选择易打理的面料，避免需要特殊护理的面料
2. 注意尺寸合适，避免过长或过短
3. 可以适当混搭现代服饰，如汉服上衣配现代裤子""",
                "tags": ["穿搭", "日常", "指南", "搭配"]
            },
            {
                "title": "汉服颜色搭配技巧",
                "category": "穿搭指南",
                "content": """颜色搭配是汉服穿搭的重要环节，掌握搭配技巧可以让整体造型更加协调美观。

【基本配色原则】
1. 主色+辅色：选择一个主色，搭配1-2个辅色
2. 色彩比例：主色占60-70%，辅色占20-30%，点缀色占10%
3. 色彩平衡：避免过于花哨，保持整体协调

【经典配色方案】
1. 粉+白：温柔优雅，适合春夏
2. 蓝+白：清新淡雅，适合日常
3. 红+黑：经典搭配，适合正式场合
4. 绿+米：自然清新，适合休闲
5. 紫+白：高贵典雅，适合特殊场合

【季节配色】
1. 春夏：选择清新淡雅的颜色，如粉、蓝、绿、白
2. 秋冬：选择温暖厚重的颜色，如红、棕、深蓝、黑

【肤色搭配】
1. 白皙肤色：适合各种颜色，尤其适合粉、蓝、绿
2. 偏黄肤色：适合暖色调，如红、橙、米色
3. 偏黑肤色：适合深色和亮色，避免过于暗淡的颜色

【场合配色】
1. 日常：选择素雅的颜色，避免过于鲜艳
2. 正式：选择庄重的颜色，如深蓝、黑色、深红
3. 节日：选择喜庆的颜色，如红色、金色""",
                "tags": ["颜色", "搭配", "技巧", "指南"]
            },
            {
                "title": "汉服配饰的选择与搭配",
                "category": "穿搭指南",
                "content": """配饰是汉服穿搭的点睛之笔，合适的配饰可以让整体造型更加完整。

【发饰选择】
1. 发簪：适合正式场合，选择与服装颜色协调的发簪
2. 发带：适合日常，简单实用
3. 发钗：适合特殊场合，更加华丽
4. 步摇：适合正式场合，增添动感

【腰带选择】
1. 材质：选择与服装材质协调的腰带
2. 颜色：选择与服装主色或辅色协调的腰带
3. 宽度：根据服装款式选择合适宽度的腰带

【鞋子选择】
1. 绣花鞋：传统选择，适合正式场合
2. 布鞋：日常选择，舒适实用
3. 现代平底鞋：现代混搭，适合日常

【其他配饰】
1. 荷包：实用又美观，可以搭配腰带
2. 扇子：夏季必备，既实用又美观
3. 披帛：适合正式场合，增添飘逸感

【搭配原则】
1. 数量控制：配饰不宜过多，2-3件即可
2. 风格统一：配饰风格要与服装风格统一
3. 颜色协调：配饰颜色要与服装颜色协调""",
                "tags": ["配饰", "选择", "搭配", "指南"]
            },
            {
                "title": "不同场合的汉服穿搭建议",
                "category": "穿搭指南",
                "content": """不同场合需要不同的汉服穿搭，掌握场合穿搭技巧可以让穿着更加得体。

【工作场合】
1. 形制选择：选择简洁的形制，如褙子、衫裙
2. 颜色选择：选择素雅的颜色，避免过于鲜艳
3. 配饰选择：选择简单的配饰，避免过于华丽
4. 面料选择：选择易打理的面料，如棉麻

【休闲场合】
1. 形制选择：可以选择各种形制，根据个人喜好
2. 颜色选择：可以选择活泼的颜色
3. 配饰选择：可以自由搭配
4. 舒适度：注重舒适度，选择适合活动的款式

【正式场合】
1. 形制选择：选择传统形制，如袄裙、深衣
2. 颜色选择：选择庄重的颜色，如深蓝、黑色
3. 配饰选择：选择精致的配饰
4. 工艺要求：选择工艺精细的服装

【节日庆典】
1. 形制选择：选择传统形制，体现节日氛围
2. 颜色选择：选择喜庆的颜色，如红色、金色
3. 配饰选择：选择华丽的配饰
4. 整体造型：注重整体造型的完整性

【拍照写真】
1. 形制选择：可以选择各种形制，根据拍摄主题
2. 颜色选择：选择上镜的颜色，如粉、蓝、白
3. 配饰选择：选择精致的配饰，增强视觉效果
4. 整体协调：注重整体造型的协调性""",
                "tags": ["场合", "穿搭", "建议", "指南"]
            },
            {
                "title": "汉服季节穿搭指南",
                "category": "穿搭指南",
                "content": """不同季节需要不同的汉服穿搭，掌握季节穿搭技巧可以让穿着更加舒适美观。

【春季穿搭】
1. 面料选择：选择轻薄的面料，如棉麻、薄真丝
2. 颜色选择：选择清新的颜色，如粉、蓝、绿、白
3. 形制选择：选择简洁的形制，如褙子、衫裙
4. 内搭：可以加薄内搭，如薄衫子

【夏季穿搭】
1. 面料选择：选择透气的面料，如棉麻、真丝
2. 颜色选择：选择清爽的颜色，如白、浅蓝、浅绿
3. 形制选择：选择简洁的形制，避免多层叠穿
4. 配饰：选择轻便的配饰，如发带

【秋季穿搭】
1. 面料选择：选择中等厚度的面料，如厚棉、混纺
2. 颜色选择：选择温暖的颜色，如米、棕、深蓝
3. 形制选择：可以选择各种形制，可以加外搭
4. 内搭：可以加内搭，如中衣

【冬季穿搭】
1. 面料选择：选择厚实的面料，如呢料、毛料
2. 颜色选择：选择厚重的颜色，如深蓝、黑色、深红
3. 形制选择：可以选择各种形制，可以多层叠穿
4. 保暖：可以加厚内搭，如厚中衣、毛衣""",
                "tags": ["季节", "穿搭", "指南", "实用"]
            },
            {
                "title": "汉服选购指南",
                "category": "穿搭指南",
                "content": """选购汉服需要掌握一些基本知识，才能选到合适的款式。

【形制判断】
1. 了解基本形制：了解不同朝代的形制特点
2. 检查形制规范：确保形制符合历史规范
3. 避免形制错误：避免选择形制错误的款式

【质量检查】
1. 面料检查：检查面料质量，确保无瑕疵
2. 工艺检查：检查缝线、裁剪等工艺
3. 细节检查：检查细节处理，如系带、纽扣等

【尺寸选择】
1. 测量尺寸：准确测量胸围、腰围、衣长等
2. 参考尺码表：参考商家的尺码表
3. 考虑穿着效果：考虑穿着后的效果

【价格判断】
1. 了解市场价：了解同类产品的市场价格
2. 性价比考虑：考虑价格与质量的比值
3. 避免盲目追求：避免盲目追求低价或高价

【商家选择】
1. 选择信誉商家：选择信誉良好的商家
2. 查看评价：查看其他买家的评价
3. 了解售后：了解售后服务政策

【网购注意事项】
1. 仔细查看图片：仔细查看商品图片
2. 了解退换政策：了解退换货政策
3. 保留购买凭证：保留购买凭证，便于维权""",
                "tags": ["选购", "指南", "实用", "建议"]
            },
            {
                "title": "汉服保养的正确方法",
                "category": "穿搭指南",
                "content": """正确的保养方法可以延长汉服的使用寿命，保持其美观。

【清洗方法】
1. 真丝汉服：建议干洗或手洗，使用专用真丝洗涤剂，水温不超过30度
2. 棉麻汉服：可以机洗，但建议使用轻柔模式，水温不超过40度
3. 混纺汉服：根据主要成分选择清洗方式

【晾晒注意事项】
1. 避免阳光直射，选择阴凉通风处晾晒
2. 真丝汉服应反面晾晒，避免褪色
3. 不要用力拧干，可用毛巾包裹吸水

【存放方法】
1. 清洗干净后存放，避免污渍残留
2. 使用衣架悬挂，避免折叠产生折痕
3. 真丝汉服建议用无纺布包裹
4. 存放环境要干燥，避免潮湿

【防虫防霉】
1. 定期检查，发现虫蛀及时处理
2. 可使用樟脑丸、防虫剂等
3. 保持存放环境通风干燥

【修复技巧】
1. 小破洞可用同色线缝补
2. 脱线及时处理，避免扩大
3. 严重损坏建议找专业裁缝修复

【特殊处理】
1. 真丝汉服避免使用漂白剂
2. 刺绣部分要特别小心，避免勾丝
3. 深色和浅色分开清洗，避免染色""",
                "tags": ["保养", "清洗", "维护", "指南"]
            },
            {
                "title": "汉服定制流程与注意事项",
                "category": "穿搭指南",
                "content": """汉服定制可以获得更合身的服装，但需要了解定制流程和注意事项。

【定制流程】
1. 选择商家：选择信誉良好的定制商家
2. 选择形制：确定要定制的形制
3. 选择面料：选择合适的面料
4. 测量尺寸：准确测量身体尺寸
5. 确认设计：确认款式、颜色、装饰等细节
6. 制作周期：了解制作周期，通常为2-4周
7. 验收试穿：收到后试穿，如有问题及时沟通

【尺寸测量】
1. 胸围：测量胸部最丰满处的围度
2. 腰围：测量腰部最细处的围度
3. 衣长：根据个人喜好和形制要求确定
4. 袖长：测量从肩点到手腕的长度
5. 裙长：根据个人身高和喜好确定

【面料选择】
1. 真丝：适合正式场合，需要特殊护理
2. 棉麻：适合日常，易打理
3. 混纺：兼顾美观和实用
4. 根据季节选择合适的面料

【注意事项】
1. 提前规划：定制需要时间，提前规划
2. 沟通清楚：与商家充分沟通，确认所有细节
3. 保留凭证：保留定制凭证，便于维权
4. 试穿检查：收到后仔细检查，如有问题及时处理""",
                "tags": ["定制", "流程", "指南", "实用"]
            },
            {
                "title": "汉服礼仪与穿着规范",
                "category": "穿搭指南",
                "content": """穿着汉服需要了解基本的礼仪和规范，体现对传统文化的尊重。

【基本礼仪】
1. 穿着整齐：确保服装穿着整齐，系带系好
2. 保持清洁：保持服装清洁，避免污渍
3. 尊重形制：尊重传统形制，避免随意改动
4. 场合适应：根据场合选择合适的形制

【穿着规范】
1. 内搭要求：穿着合适的内搭，避免过于暴露
2. 系带规范：系带要系好，不能过于松散
3. 配饰搭配：配饰要与服装协调，不能过于突兀
4. 整体协调：注重整体造型的协调性

【行为举止】
1. 坐姿：坐下时注意整理裙摆，避免压皱
2. 行走：行走时注意步伐，避免踩到裙摆
3. 行礼：了解基本的行礼方式，如作揖等
4. 尊重：尊重传统文化，避免不当行为

【场合礼仪】
1. 正式场合：穿着传统形制，行为庄重
2. 日常场合：可以穿着改良款式，但保持基本规范
3. 节日庆典：穿着传统形制，体现节日氛围
4. 文化活动：穿着传统形制，体现文化内涵""",
                "tags": ["礼仪", "规范", "指南", "文化"]
            },
            {
                "title": "半臂的形制特点与搭配",
                "category": "形制科普",
                "content": """半臂是唐代和魏晋时期流行的短袖外衣，其形制简洁实用。

【形制特点】
1. 短袖设计：袖子较短，通常至肘部
2. 长度变化：有长半臂和短半臂之分
3. 领型：有交领、对襟等款式
4. 开衩：两侧有开衩，方便活动

【历史背景】
半臂在唐代和魏晋时期最为流行，是日常穿着的实用外衣。从唐代壁画和文物中可以看到半臂的形象。

【穿着方法】
1. 先穿好内搭
2. 将半臂套在外面
3. 使用系带或纽扣固定
4. 可搭配襦裙、衫裙等下裳

【搭配建议】
- 半臂+齐胸襦裙：唐代经典搭配
- 半臂+衫裙：日常舒适搭配
- 半臂+现代内搭：现代混搭风格

【现代应用】
半臂因其简洁实用的特点，在现代汉服中适合日常穿着，是春秋季节的理想选择。""",
                "tags": ["唐代", "魏晋", "半臂", "形制"]
            },
            {
                "title": "帔子的形制特点与佩戴方法",
                "category": "形制科普",
                "content": """帔子是唐代和魏晋时期流行的配饰，其形制优雅飘逸。

【形制特点】
1. 长条设计：帔子为长条状，通常长度在2-3米
2. 宽度：宽度通常在30-50厘米
3. 材质：通常使用轻薄的面料，如真丝、薄纱等
4. 装饰：可在两端装饰流苏、刺绣等

【历史背景】
帔子在唐代和魏晋时期最为流行，是贵族女性的标志性配饰。从唐代壁画和文物中可以看到帔子的形象。

【佩戴方法】
1. 披在肩上：将帔子披在肩上，两端自然下垂
2. 绕在手臂：将帔子绕在手臂上，形成飘逸效果
3. 交叉佩戴：将帔子在胸前交叉，形成装饰效果
4. 根据场合和个人喜好选择佩戴方式

【搭配建议】
- 帔子+齐胸襦裙：唐代经典搭配
- 帔子+大袖衫：魏晋风格搭配
- 帔子+现代汉服：现代混搭风格

【现代应用】
帔子在现代汉服中主要用于特殊场合和拍照，因其飘逸的特点不太适合日常活动。""",
                "tags": ["唐代", "魏晋", "帔子", "配饰"]
            },
            {
                "title": "抹胸的形制特点与穿着方法",
                "category": "形制科普",
                "content": """抹胸是宋代流行的内搭，其形制简洁实用。

【形制特点】
1. 无袖设计：抹胸为无袖设计，贴合身体
2. 长度：长度通常在胸部至腰部
3. 系带：使用系带在背后固定
4. 材质：通常使用柔软的面料

【历史背景】
抹胸在宋代最为流行，是宋代女性日常穿着的标准内搭。从宋代绘画和文物中可以看到抹胸的形象。

【穿着方法】
1. 将抹胸围在胸部
2. 调整位置，确保贴合
3. 在背后系好系带
4. 可搭配褙子、衫子等外衣

【搭配建议】
- 抹胸+褙子：宋代经典搭配
- 抹胸+衫子：日常舒适搭配
- 抹胸+现代外衣：现代混搭风格

【现代应用】
抹胸在现代汉服中作为内搭使用，是宋代风格搭配的重要组成部分。""",
                "tags": ["宋代", "抹胸", "形制", "内搭"]
            },
            {
                "title": "道袍的形制特点与文化意义",
                "category": "形制科普",
                "content": """道袍是明代流行的男装，其形制庄重典雅。

【形制特点】
1. 交领设计：道袍为交领，领子交叉
2. 长度：长度通常较长，至脚踝
3. 袖型：通常为宽袖，袖口较宽
4. 系带：使用系带固定

【历史背景】
道袍在明代最为流行，是明代男性正式场合的标准装束。从明代画像和文物中可以看到道袍的形象。

【文化意义】
道袍体现了明代文人的审美追求，追求内在的修养而非外在的华丽。道袍也是礼制的重要体现。

【穿着方法】
1. 先穿好内搭
2. 将道袍穿好，交领对齐
3. 使用系带固定
4. 可搭配腰带等配饰

【现代应用】
道袍在现代汉服中主要用于正式场合和传统文化活动，是了解明代服饰文化的重要窗口。""",
                "tags": ["明代", "道袍", "形制", "文化"]
            },
            {
                "title": "比甲的形制特点与搭配",
                "category": "形制科普",
                "content": """比甲是明代流行的无袖外衣，其形制简洁实用。

【形制特点】
1. 无袖设计：比甲为无袖设计，方便活动
2. 对襟：比甲为对襟，使用系带或纽扣固定
3. 长度：长度通常在腰部或臀部
4. 开衩：两侧有开衩，方便活动

【历史背景】
比甲在明代最为流行，是明代女性日常穿着的实用外衣。从明代画像和文物中可以看到比甲的形象。

【穿着方法】
1. 先穿好内搭
2. 将比甲套在外面，对襟对齐
3. 使用系带或纽扣固定
4. 可搭配袄裙、衫裙等下裳

【搭配建议】
- 比甲+袄裙：明代经典搭配
- 比甲+衫裙：日常舒适搭配
- 比甲+现代内搭：现代混搭风格

【现代应用】
比甲因其简洁实用的特点，在现代汉服中适合日常穿着，是春秋季节的理想选择。""",
                "tags": ["明代", "比甲", "形制", "搭配"]
            },
            {
                "title": "汉服面料的种类与特点",
                "category": "穿搭指南",
                "content": """了解不同面料的特点，有助于选择合适的汉服。

【真丝面料】
1. 特点：质地柔软，光泽好，垂坠感强
2. 优点：美观，适合正式场合
3. 缺点：需要特殊护理，价格较高
4. 适用：正式场合，特殊活动

【棉麻面料】
1. 特点：透气性好，舒适度高
2. 优点：易打理，价格适中
3. 缺点：容易起皱，需要熨烫
4. 适用：日常穿着，休闲场合

【混纺面料】
1. 特点：结合不同材料的优点
2. 优点：兼顾美观和实用
3. 缺点：质量参差不齐
4. 适用：日常穿着，各种场合

【呢料面料】
1. 特点：厚实，保暖性好
2. 优点：适合秋冬季节
3. 缺点：较重，价格较高
4. 适用：秋冬季节，正式场合

【选择建议】
1. 根据场合选择：正式场合选择真丝，日常选择棉麻
2. 根据季节选择：春夏选择轻薄面料，秋冬选择厚实面料
3. 根据预算选择：预算充足选择真丝，预算有限选择棉麻""",
                "tags": ["面料", "种类", "特点", "指南"]
            },
            {
                "title": "汉服与现代生活的融合",
                "category": "穿搭指南",
                "content": """汉服与现代生活的融合，让传统文化更好地融入现代生活。

【日常穿着】
1. 选择简洁形制：选择适合日常的简洁形制
2. 混搭现代服饰：可以适当混搭现代服饰
3. 注重实用性：注重穿着的实用性和舒适度
4. 保持基本规范：保持汉服的基本形制规范

【工作场合】
1. 选择素雅款式：选择素雅的款式和颜色
2. 保持整洁：保持服装整洁，体现专业形象
3. 注意场合：根据工作场合选择合适的形制
4. 尊重文化：尊重传统文化，避免不当行为

【社交活动】
1. 选择合适形制：根据活动性质选择合适的形制
2. 注重整体造型：注重整体造型的协调性
3. 了解基本礼仪：了解基本的汉服礼仪
4. 尊重他人：尊重他人的穿着选择

【文化传承】
1. 学习传统文化：通过学习汉服了解传统文化
2. 参与文化活动：参与汉服相关的文化活动
3. 传播文化：向他人传播汉服文化
4. 创新发展：在传承的基础上创新发展""",
                "tags": ["现代生活", "融合", "指南", "文化"]
            },
        ]
        
        for item_data in manual_items:
            item = self.create_knowledge_item(
                title=item_data['title'],
                content=item_data['content'],
                category=item_data['category'],
                tags=item_data['tags'],
                source="手工整理"
            )
            if item:
                self.items.append(item)
                print(f"  ✓ 添加手工整理内容: {item['title']}")


def main():
    """主函数"""
    fetcher = KnowledgeFetcher()
    items = fetcher.generate_real_knowledge()
    
    if not items:
        print("警告：未能抓取到任何数据，请检查网络连接或使用备用方案")
        return
    
    # 检查唯一性
    from collections import Counter
    ids = [item['id'] for item in items]
    titles = [item['title'] for item in items]
    contents = [item['content'][:200] for item in items]  # 用前200字符判断
    
    duplicate_ids = {k: v for k, v in Counter(ids).items() if v > 1}
    duplicate_titles = {k: v for k, v in Counter(titles).items() if v > 1}
    duplicate_contents = {k: v for k, v in Counter(contents).items() if v > 1}
    
    if duplicate_ids:
        print(f"\n警告：存在重复的ID！{duplicate_ids}")
    if duplicate_titles:
        print(f"警告：存在重复的标题！共{len(duplicate_titles)}条")
    if duplicate_contents:
        print(f"警告：存在重复的内容！共{len(duplicate_contents)}条")
    
    # 统计分类
    categories = Counter([item['category'] for item in items])
    
    # 创建JSON数据
    data = {
        "version": "2.0",
        "lastUpdated": datetime.now().isoformat(),
        "total": len(items),
        "items": items
    }
    
    # 保存到文件
    script_dir = os.path.dirname(os.path.abspath(__file__))
    output_file = os.path.join(script_dir, '../assets/data/knowledge_base.json')
    os.makedirs(os.path.dirname(output_file), exist_ok=True)
    
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print(f"\n{'='*60}")
    print(f"生成完成！共生成 {len(items)} 条真实知识数据")
    print(f"{'='*60}")
    for cat, count in sorted(categories.items()):
        print(f"  {cat}: {count} 条")
    print(f"\n唯一ID数: {len(set(ids))}")
    print(f"唯一标题数: {len(set(titles))}")
    print(f"唯一内容数: {len(set(contents))}")
    print(f"\n数据已保存到: {os.path.abspath(output_file)}")


if __name__ == "__main__":
    main()

